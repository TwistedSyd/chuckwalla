<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guitar - Chuckwalla</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #2d2d2d;
            color: #f5f5f5;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
            font-size: 32px;
            letter-spacing: 2px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-button {
            background: #3a3a3a;
            color: #ccc;
            border: 2px solid #555;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s;
        }

        .tab-button:hover {
            border-color: #666;
            color: #fff;
        }

        .tab-button.active {
            background: #f97316;
            color: #1a1a1a;
            border-color: #f97316;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .controls-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #3a3a3a;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .control-group h3 {
            color: #f97316;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .control-group select,
        .control-group button {
            width: 100%;
            padding: 10px;
            background: #2d2d2d;
            border: 1px solid #555;
            border-radius: 4px;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .control-group button {
            background: #f97316;
            color: #1a1a1a;
            border: none;
            font-weight: bold;
            transition: all 0.2s;
        }

        .control-group button:hover {
            background: #ea580c;
            transform: scale(1.02);
        }

        .control-group select:hover {
            border-color: #666;
        }

        .fretboard-container {
            background: #3a3a3a;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            overflow-x: auto;
        }

        .fretboard {
            position: relative;
            width: fit-content;
            margin: 0 auto;
            padding: 20px 0;
        }

        .string {
            display: flex;
            align-items: center;
            position: relative;
            margin-bottom: 15px;
        }

        .string:last-child {
            margin-bottom: 0;
        }

        .string-label {
            width: 40px;
            text-align: right;
            margin-right: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #aaa;
        }

        .string-line {
            flex: 1;
            height: 2px;
            background: #666;
            position: relative;
        }

        .string-line.thick {
            height: 3px;
            background: #777;
        }

        .fret {
            position: absolute;
            width: 2px;
            height: calc(6 * 50px);
            background: #555;
            top: -10px;
        }

        .fret-marker {
            position: absolute;
            width: 100%;
            text-align: center;
            top: calc(6 * 50px + 10px);
            font-size: 11px;
            color: #666;
        }

        .note-dot {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #f97316;
            border: 2px solid #ea580c;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            transform: translate(-50%, -50%);
            z-index: 2;
        }

        .note-dot:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.6);
        }

        .note-dot.active {
            background: #fb923c;
            border-color: #f97316;
            box-shadow: 0 0 20px rgba(251, 146, 60, 0.7);
        }

        .note-dot.root {
            background: #ec4899;
            border-color: #db2777;
        }

        .note-dot.root.active {
            background: #f9a8d4;
            border-color: #f472b6;
            box-shadow: 0 0 20px rgba(249, 168, 212, 0.7);
        }

        .note-dot.highlighted {
            background: #f97316;
            border-color: #ea580c;
            box-shadow: 0 0 5px rgba(249, 115, 22, 0.3);
        }

        .ghost-note {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(249, 115, 22, 0.08);
            border: 2px solid rgba(249, 115, 22, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            z-index: 1;
            pointer-events: none;
        }

        .ghost-note.active {
            background: rgba(251, 146, 60, 0.3);
            border-color: rgba(249, 115, 22, 0.5);
            box-shadow: 0 0 15px rgba(251, 146, 60, 0.4);
        }

        .ghost-note.root {
            background: rgba(236, 72, 153, 0.08);
            border-color: rgba(236, 72, 153, 0.15);
        }

        .ghost-note.root.active {
            background: rgba(249, 168, 212, 0.3);
            border-color: rgba(244, 114, 182, 0.5);
            box-shadow: 0 0 15px rgba(249, 168, 212, 0.4);
        }

        .info-panel {
            background: #3a3a3a;
            border: 2px solid #555;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .info-panel h2 {
            color: #f97316;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .info-panel p {
            line-height: 1.6;
            color: #aaa;
            margin-bottom: 10px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
        }

        .info-item label {
            color: #888;
            font-size: 12px;
            display: block;
            margin-bottom: 5px;
        }

        .info-item value {
            color: #fff;
            font-size: 16px;
            font-weight: bold;
        }

        .octave-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .octave-controls button {
            background: #555;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.2s;
        }

        .octave-controls button:hover {
            background: #666;
        }

        .octave-controls span {
            font-size: 18px;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
        }

        .roadmap-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .roadmap-section {
            background: #3a3a3a;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .roadmap-section h2 {
            color: #f97316;
            margin-bottom: 15px;
            font-size: 22px;
        }

        .roadmap-section h3 {
            color: #fff;
            margin: 20px 0 10px 0;
            font-size: 18px;
        }

        .roadmap-section p,
        .roadmap-section li {
            color: #ccc;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .roadmap-section ul,
        .roadmap-section ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        .level-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            letter-spacing: 0.5px;
            margin-right: 10px;
        }

        .level-badge.beginner {
            background: #2a9d2a;
            color: #fff;
        }

        .level-badge.intermediate {
            background: #f59e0b;
            color: #fff;
        }

        .level-badge.advanced {
            background: #ef4444;
            color: #fff;
        }

        .tip-box {
            background: rgba(249, 115, 22, 0.1);
            border-left: 4px solid #f97316;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .tip-box strong {
            color: #f97316;
        }

        .chord-diagram {
            display: inline-block;
            margin: 10px;
            padding: 15px;
            background: #2d2d2d;
            border-radius: 8px;
            text-align: center;
        }

        .chord-diagram h4 {
            color: #f97316;
            margin-bottom: 10px;
        }

        .scale-chords-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .chord-button {
            background: #2d2d2d;
            border: 2px solid #555;
            color: #fff;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            transition: all 0.2s;
            text-align: center;
            min-width: 120px;
        }

        .chord-button:hover {
            border-color: #f97316;
            background: #3a3a3a;
            transform: translateY(-2px);
        }

        .chord-button.active {
            background: #f97316;
            border-color: #f97316;
            color: #1a1a1a;
            font-weight: bold;
        }

        .chord-button .chord-name {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .chord-button .chord-quality {
            font-size: 11px;
            opacity: 0.8;
        }

        /* Navigation Icons */
        .nav-icons {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .nav-icon-button {
            width: 50px;
            height: 50px;
            background: #3a3a3a;
            border: 2px solid #555;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
        }

        .nav-icon-button:hover {
            background: #444;
            border-color: #666;
            transform: translateY(-2px);
        }

        .nav-icon-button.active {
            background: #f97316;
            border-color: #f97316;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(249, 115, 22, 0.4);
        }
    </style>
</head>
<body>
    <!-- Navigation Icons -->
    <div class="nav-icons">
        <a href="index.html" class="nav-icon-button" title="Home">🏠</a>
        <a href="drums.html" class="nav-icon-button" title="Drum Machine">🥁</a>
        <a href="piano.html" class="nav-icon-button" title="Piano">🎹</a>
        <a href="guitar.html" class="nav-icon-button active" title="Guitar">🎸</a>
        <a href="circle-of-fifths.html" class="nav-icon-button" title="Circle of Fifths">🌀</a>
    </div>

    <div class="container">
        <h1>🎸 Guitar</h1>

        <div class="tab-buttons">
            <button class="tab-button active" onclick="switchTab('play')">Free Play</button>
            <button class="tab-button" onclick="switchTab('chords')">Chords</button>
            <button class="tab-button" onclick="switchTab('scales')">Scales</button>
            <button class="tab-button" onclick="switchTab('roadmap')">Learning Roadmap</button>
        </div>

        <!-- Free Play Tab -->
        <div id="play-tab" class="tab-content active">
            <div class="controls-section">
                <div class="control-group">
                    <h3>Tuning</h3>
                    <select id="tuning-select">
                        <option value="standard">Standard (E A D G B E)</option>
                        <option value="dropd">Drop D (D A D G B E)</option>
                        <option value="halfstep">Half Step Down</option>
                    </select>
                </div>
            </div>

            <div class="fretboard-container">
                <div id="fretboard-play" class="fretboard">
                    <!-- Fretboard will be generated here -->
                </div>
            </div>
        </div>

        <!-- Chords Tab -->
        <div id="chords-tab" class="tab-content">
            <div class="controls-section">
                <div class="control-group">
                    <h3>Root Note</h3>
                    <select id="root-note-chord">
                        <option value="C">C</option>
                        <option value="C#">C# / Db</option>
                        <option value="D">D</option>
                        <option value="D#">D# / Eb</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F# / Gb</option>
                        <option value="G">G</option>
                        <option value="G#">G# / Ab</option>
                        <option value="A">A</option>
                        <option value="A#">A# / Bb</option>
                        <option value="B">B</option>
                    </select>
                </div>

                <div class="control-group">
                    <h3>Chord Type</h3>
                    <select id="chord-type">
                        <option value="major">Major</option>
                        <option value="minor">Minor</option>
                        <option value="diminished">Diminished</option>
                        <option value="augmented">Augmented</option>
                        <option value="major7">Major 7th</option>
                        <option value="minor7">Minor 7th</option>
                        <option value="dominant7">Dominant 7th</option>
                        <option value="diminished7">Diminished 7th</option>
                        <option value="sus2">Suspended 2nd</option>
                        <option value="sus4">Suspended 4th</option>
                        <option value="add9">Add 9</option>
                        <option value="major9">Major 9th</option>
                        <option value="minor9">Minor 9th</option>
                        <option value="power">Power Chord</option>
                    </select>
                </div>

                <div class="control-group">
                    <h3>Actions</h3>
                    <button onclick="playChordOrScale()">▶ Play Chord</button>
                    <button onclick="playChordOrScaleArpeggio()">🎵 Play Arpeggio</button>
                </div>
            </div>

            <div class="fretboard-container">
                <div id="fretboard-chord" class="fretboard">
                    <!-- Fretboard will be generated here -->
                </div>
            </div>

            <div class="info-panel">
                <h2>Chord Information</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <label>Notes</label>
                        <value id="info-notes-chord">-</value>
                    </div>
                    <div class="info-item">
                        <label>Intervals</label>
                        <value id="info-intervals-chord">-</value>
                    </div>
                    <div class="info-item">
                        <label>Formula</label>
                        <value id="info-formula-chord">-</value>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scales Tab -->
        <div id="scales-tab" class="tab-content">
            <div class="controls-section">
                <div class="control-group">
                    <h3>Root Note</h3>
                    <select id="root-note-scale">
                        <option value="C">C</option>
                        <option value="C#">C# / Db</option>
                        <option value="D">D</option>
                        <option value="D#">D# / Eb</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F# / Gb</option>
                        <option value="G">G</option>
                        <option value="G#">G# / Ab</option>
                        <option value="A">A</option>
                        <option value="A#">A# / Bb</option>
                        <option value="B">B</option>
                    </select>
                </div>

                <div class="control-group">
                    <h3>Scale Type</h3>
                    <select id="scale-type">
                        <option value="major">Major (Ionian)</option>
                        <option value="minor">Natural Minor (Aeolian)</option>
                        <option value="harmonicminor">Harmonic Minor</option>
                        <option value="melodicminor">Melodic Minor</option>
                        <option value="dorian">Dorian</option>
                        <option value="phrygian">Phrygian</option>
                        <option value="lydian">Lydian</option>
                        <option value="mixolydian">Mixolydian</option>
                        <option value="locrian">Locrian</option>
                        <option value="majorpentatonic">Major Pentatonic</option>
                        <option value="minorpentatonic">Minor Pentatonic</option>
                        <option value="blues">Blues</option>
                        <option value="chromatic">Chromatic</option>
                        <option value="wholetone">Whole Tone</option>
                    </select>
                </div>

                <div class="control-group">
                    <h3>Scale Position</h3>
                    <div class="octave-controls">
                        <button onclick="changeScalePosition(-1)">◀</button>
                        <span id="scale-position-display">Low E String</span>
                        <button onclick="changeScalePosition(1)">▶</button>
                    </div>
                </div>

                <div class="control-group">
                    <h3>Actions</h3>
                    <button onclick="playChordOrScaleArpeggio()">🎵 Play Ascending</button>
                </div>
            </div>

            <div class="fretboard-container">
                <div id="fretboard-scale" class="fretboard">
                    <!-- Fretboard will be generated here -->
                </div>
            </div>

            <div class="info-panel">
                <h2>Scale Information</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <label>Notes</label>
                        <value id="info-notes-scale">-</value>
                    </div>
                    <div class="info-item">
                        <label>Intervals</label>
                        <value id="info-intervals-scale">-</value>
                    </div>
                    <div class="info-item">
                        <label>Formula</label>
                        <value id="info-formula-scale">-</value>
                    </div>
                </div>

                <div id="scale-chords-container">
                    <!-- Diatonic chords will appear here -->
                </div>
            </div>
        </div>

        <!-- Learning Roadmap Tab -->
        <div id="roadmap-tab" class="tab-content">
            <div class="roadmap-container">
                <div class="roadmap-section">
                    <h2><span class="level-badge beginner">BEGINNER</span> Getting Started with Guitar</h2>

                    <h3>1. Parts of the Guitar</h3>
                    <p>Learn the anatomy: headstock, tuners, nut, fretboard, frets, strings (6th = thickest E), body, bridge, pickguard.</p>

                    <h3>2. Proper Posture & Hand Position</h3>
                    <p>Sit comfortably with guitar on your lap or use a strap. Left hand thumb behind neck, fingers curved. Right hand relaxed over soundhole/pickups.</p>

                    <h3>3. Tuning Your Guitar</h3>
                    <p>Standard tuning from 6th to 1st string: E-A-D-G-B-E. Use the tuning selector above or an electronic tuner.</p>

                    <h3>4. Open Chords</h3>
                    <p>Start with: C, G, D, E minor, A minor. Practice switching between them smoothly.</p>

                    <div class="tip-box">
                        <strong>Practice Tip:</strong> Use the Chords tab to visualize finger positions. Start with 2-chord progressions (C to G, Am to Em) before attempting more complex changes.
                    </div>

                    <h3>5. Basic Strumming Patterns</h3>
                    <p>Down strums only, then down-down-up-down-up. Keep a steady rhythm.</p>
                </div>

                <div class="roadmap-section">
                    <h2><span class="level-badge beginner">BEGINNER+</span> Building Skills</h2>

                    <h3>6. Bar Chords (Power Chords)</h3>
                    <p>F major bar chord shape, E minor shape. Move these shapes up the neck to play any chord.</p>

                    <h3>7. Pentatonic Scales</h3>
                    <p>Minor pentatonic box position 1 (most common for solos). Major pentatonic for country/rock.</p>

                    <div class="tip-box">
                        <strong>Practice Tip:</strong> Use the Scales tab to see the Minor Pentatonic pattern. This is the foundation for most rock and blues solos!
                    </div>

                    <h3>8. Reading Tabs</h3>
                    <p>Numbers on 6 lines (strings). Number = fret to press. 0 = open string.</p>
                </div>

                <div class="roadmap-section">
                    <h2><span class="level-badge intermediate">INTERMEDIATE</span> Expanding Your Skills</h2>

                    <h3>9. Major & Minor Scales</h3>
                    <p>3-notes-per-string patterns. Connect box positions across the fretboard.</p>

                    <h3>10. Chord Progressions & Theory</h3>
                    <p>I-IV-V progressions, understanding diatonic chords. Common progressions: I-V-vi-IV, I-IV-I-V</p>

                    <h3>11. Fingerpicking Patterns</h3>
                    <p>Travis picking, classical patterns. Thumb plays bass notes, fingers play melody.</p>

                    <div class="tip-box">
                        <strong>Practice Tip:</strong> In the Scales tab, click on diatonic chords to hear how chords from a scale sound together.
                    </div>
                </div>

                <div class="roadmap-section">
                    <h2><span class="level-badge advanced">ADVANCED</span> Mastery & Expression</h2>

                    <h3>12. Modes & Advanced Harmony</h3>
                    <p>Dorian, Phrygian, Lydian, Mixolydian modes. Modal interchange and borrowing chords.</p>

                    <h3>13. Lead Techniques</h3>
                    <p>Bends, vibrato, hammer-ons, pull-offs, slides. String skipping and sweep picking.</p>

                    <h3>14. Jazz Chords & Voicings</h3>
                    <p>7th, 9th, 11th, 13th chords. Drop 2 and Drop 3 voicings.</p>

                    <h3>15. Composition & Improvisation</h3>
                    <p>Creating solos using scales and arpeggios. Tension and resolution. Call and response phrasing.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Audio context
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // Current tab
        let currentTab = 'play';

        // Current scale position (1-6, representing which string to start on)
        let currentScalePosition = 1; // 1 = Low E (string 0), 6 = High E (string 5)

        // Guitar tunings
        const tunings = {
            standard: ['E', 'A', 'D', 'G', 'B', 'E'],
            dropd: ['D', 'A', 'D', 'G', 'B', 'E'],
            halfstep: ['D#', 'G#', 'C#', 'F#', 'A#', 'D#']
        };

        // String base octaves for standard tuning
        const stringOctaves = [2, 2, 3, 3, 3, 4]; // E2, A2, D3, G3, B3, E4

        // Chromatic scale
        const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

        // Note display names
        const noteDisplay = {
            'C#': 'C♯', 'D#': 'D♯', 'F#': 'F♯', 'G#': 'G♯', 'A#': 'A♯'
        };

        // Chord formulas (same as piano)
        const chordFormulas = {
            major: { intervals: [0, 4, 7], formula: '1-3-5', name: 'Major' },
            minor: { intervals: [0, 3, 7], formula: '1-♭3-5', name: 'Minor' },
            diminished: { intervals: [0, 3, 6], formula: '1-♭3-♭5', name: 'Diminished' },
            augmented: { intervals: [0, 4, 8], formula: '1-3-♯5', name: 'Augmented' },
            major7: { intervals: [0, 4, 7, 11], formula: '1-3-5-7', name: 'Major 7th' },
            minor7: { intervals: [0, 3, 7, 10], formula: '1-♭3-5-♭7', name: 'Minor 7th' },
            dominant7: { intervals: [0, 4, 7, 10], formula: '1-3-5-♭7', name: 'Dominant 7th' },
            diminished7: { intervals: [0, 3, 6, 9], formula: '1-♭3-♭5-♭♭7', name: 'Diminished 7th' },
            sus2: { intervals: [0, 2, 7], formula: '1-2-5', name: 'Suspended 2nd' },
            sus4: { intervals: [0, 5, 7], formula: '1-4-5', name: 'Suspended 4th' },
            add9: { intervals: [0, 4, 7, 14], formula: '1-3-5-9', name: 'Add 9' },
            major9: { intervals: [0, 4, 7, 11, 14], formula: '1-3-5-7-9', name: 'Major 9th' },
            minor9: { intervals: [0, 3, 7, 10, 14], formula: '1-♭3-5-♭7-9', name: 'Minor 9th' },
            power: { intervals: [0, 7], formula: '1-5', name: 'Power Chord' }
        };

        // Scale formulas (same as piano)
        const scaleFormulas = {
            major: {
                intervals: [0, 2, 4, 5, 7, 9, 11],
                formula: 'W-W-H-W-W-W-H',
                name: 'Major (Ionian)',
                chords: ['Maj', 'min', 'min', 'Maj', 'Maj', 'min', 'dim']
            },
            minor: {
                intervals: [0, 2, 3, 5, 7, 8, 10],
                formula: 'W-H-W-W-H-W-W',
                name: 'Natural Minor (Aeolian)',
                chords: ['min', 'dim', 'Maj', 'min', 'min', 'Maj', 'Maj']
            },
            harmonicminor: {
                intervals: [0, 2, 3, 5, 7, 8, 11],
                formula: 'W-H-W-W-H-W+H-H',
                name: 'Harmonic Minor',
                chords: ['min', 'dim', 'aug', 'min', 'Maj', 'Maj', 'dim']
            },
            melodicminor: {
                intervals: [0, 2, 3, 5, 7, 9, 11],
                formula: 'W-H-W-W-W-W-H',
                name: 'Melodic Minor',
                chords: ['min', 'min', 'aug', 'Maj', 'Maj', 'dim', 'dim']
            },
            dorian: {
                intervals: [0, 2, 3, 5, 7, 9, 10],
                formula: 'W-H-W-W-W-H-W',
                name: 'Dorian',
                chords: ['min', 'min', 'Maj', 'Maj', 'min', 'dim', 'Maj']
            },
            phrygian: {
                intervals: [0, 1, 3, 5, 7, 8, 10],
                formula: 'H-W-W-W-H-W-W',
                name: 'Phrygian',
                chords: ['min', 'Maj', 'Maj', 'min', 'dim', 'Maj', 'min']
            },
            lydian: {
                intervals: [0, 2, 4, 6, 7, 9, 11],
                formula: 'W-W-W-H-W-W-H',
                name: 'Lydian',
                chords: ['Maj', 'Maj', 'min', 'dim', 'Maj', 'min', 'min']
            },
            mixolydian: {
                intervals: [0, 2, 4, 5, 7, 9, 10],
                formula: 'W-W-H-W-W-H-W',
                name: 'Mixolydian',
                chords: ['Maj', 'min', 'dim', 'Maj', 'min', 'min', 'Maj']
            },
            locrian: {
                intervals: [0, 1, 3, 5, 6, 8, 10],
                formula: 'H-W-W-H-W-W-W',
                name: 'Locrian',
                chords: ['dim', 'Maj', 'min', 'min', 'Maj', 'Maj', 'min']
            },
            majorpentatonic: {
                intervals: [0, 2, 4, 7, 9],
                formula: 'W-W-W+H-W-W+H',
                name: 'Major Pentatonic',
                chords: ['5-note scale - diatonic chords not typically defined']
            },
            minorpentatonic: {
                intervals: [0, 3, 5, 7, 10],
                formula: 'W+H-W-W-W+H-W',
                name: 'Minor Pentatonic',
                chords: ['5-note scale - diatonic chords not typically defined']
            },
            blues: {
                intervals: [0, 3, 5, 6, 7, 10],
                formula: 'W+H-W-H-H-W+H-W',
                name: 'Blues Scale',
                chords: ['6-note scale - often used over dominant 7th chords']
            },
            chromatic: {
                intervals: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
                formula: 'H-H-H-H-H-H-H-H-H-H-H-H',
                name: 'Chromatic',
                chords: ['12-note scale - includes all notes']
            },
            wholetone: {
                intervals: [0, 2, 4, 6, 8, 10],
                formula: 'W-W-W-W-W-W',
                name: 'Whole Tone',
                chords: ['6-note scale - augmented harmony']
            }
        };

        // Generate frequency for a note
        function getNoteFrequency(note, octave) {
            const noteIndex = notes.indexOf(note);
            const A4 = 440;
            const A4Index = 9; // A is at index 9
            const semitones = (octave - 4) * 12 + (noteIndex - A4Index);
            return A4 * Math.pow(2, semitones / 12);
        }

        // Play a single note
        function playNote(note, octave, duration = 0.5) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();

            osc.type = 'sine';
            osc.frequency.value = getNoteFrequency(note, octave);

            gain.gain.setValueAtTime(0.3, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

            osc.connect(gain);
            gain.connect(audioContext.destination);

            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + duration);
        }

        // Generate fretboard
        function generateFretboard(containerId, isInteractive = true) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            const tuning = tunings[document.getElementById('tuning-select')?.value || 'standard'];
            const numFrets = 12;
            const fretWidth = 60;

            // Get current chord/scale notes if in chords or scales tab
            let highlightNotes = [];
            let rootNote = null;
            let startingRootInfo = null; // For position-based scales
            let noteOccurrences = new Map(); // Track all occurrences of each note

            if (currentTab === 'chords' || currentTab === 'scales') {
                const { notes: theoryNotes } = calculateNotes();
                highlightNotes = theoryNotes;
                rootNote = document.getElementById(currentTab === 'chords' ? 'root-note-chord' : 'root-note-scale').value;

                // For scales, get the box pattern for the selected string position
                if (currentTab === 'scales') {
                    const targetStringIndex = currentScalePosition - 1; // Convert position to string index
                    const boxPattern = getScaleBoxPattern(targetStringIndex, rootNote, highlightNotes);

                    // Store box pattern notes in map for quick lookup
                    boxPattern.forEach(noteInfo => {
                        const key = `${noteInfo.string}_${noteInfo.fret}`;
                        noteOccurrences.set(key, noteInfo);
                    });
                }
            }

            // Create strings with note dots
            tuning.slice().reverse().forEach((stringNote, stringIndex) => {
                const actualStringIndex = tuning.length - 1 - stringIndex;
                const stringDiv = document.createElement('div');
                stringDiv.className = 'string';

                // String label
                const label = document.createElement('div');
                label.className = 'string-label';
                label.textContent = stringNote;
                stringDiv.appendChild(label);

                // String line
                const line = document.createElement('div');
                line.className = `string-line ${actualStringIndex < 3 ? 'thick' : ''}`;
                line.style.width = `${(numFrets + 1) * fretWidth}px`;

                // Add note dots for this string
                if (isInteractive && highlightNotes.length > 0) {
                    const stringNoteIndex = notes.indexOf(stringNote);
                    const stringOctave = stringOctaves[actualStringIndex];

                    for (let fret = 0; fret <= numFrets; fret++) {
                        const fretNoteIndex = (stringNoteIndex + fret) % 12;
                        const fretNote = notes[fretNoteIndex];
                        const fretOctave = stringOctave + Math.floor((stringNoteIndex + fret) / 12);

                        // Check if this note is in the chord/scale
                        if (highlightNotes.includes(fretNote)) {
                            let isGhost = false;
                            let isPrimaryNote = false;

                            // For scales tab, use box pattern logic
                            if (currentTab === 'scales') {
                                // Check if this position is in the box pattern
                                const posKey = `${actualStringIndex}_${fret}`;
                                const boxNote = noteOccurrences.get(posKey);

                                if (boxNote) {
                                    isPrimaryNote = true;
                                } else {
                                    isGhost = true;
                                }
                            }

                            const dot = document.createElement('div');
                            dot.className = isGhost ? 'ghost-note' : 'note-dot';
                            if (fretNote === rootNote) {
                                dot.className += ' root';
                            }

                            // Position the dot
                            const xPos = 50 + fret * fretWidth + (fret === 0 ? 0 : fretWidth / 2);
                            dot.style.left = `${xPos}px`;
                            dot.style.top = '50%';

                            // Display note name
                            dot.textContent = noteDisplay[fretNote] || fretNote;

                            // Store note data
                            dot.dataset.note = fretNote;
                            dot.dataset.octave = fretOctave;
                            dot.dataset.string = actualStringIndex;
                            dot.dataset.fret = fret;

                            // Add click handler (only for non-ghost notes)
                            if (!isGhost) {
                                dot.addEventListener('click', function() {
                                    playNote(this.dataset.note, parseInt(this.dataset.octave), 0.8);

                                    // Visual feedback
                                    this.classList.add('active');
                                    setTimeout(() => {
                                        this.classList.remove('active');
                                    }, 800);
                                });
                            }

                            line.appendChild(dot);
                        }
                    }
                }

                stringDiv.appendChild(line);
                container.appendChild(stringDiv);
            });

            // Add fret markers
            for (let fret = 0; fret <= numFrets; fret++) {
                const fretLine = document.createElement('div');
                fretLine.className = 'fret';
                fretLine.style.left = `${50 + fret * fretWidth}px`;
                container.appendChild(fretLine);

                const marker = document.createElement('div');
                marker.className = 'fret-marker';
                marker.style.left = `${50 + fret * fretWidth}px`;
                marker.textContent = fret;
                container.appendChild(marker);
            }
        }

        // Calculate chord or scale notes
        function calculateNotes() {
            const isChordTab = currentTab === 'chords';
            const root = document.getElementById(isChordTab ? 'root-note-chord' : 'root-note-scale').value;
            const type = document.getElementById(isChordTab ? 'chord-type' : 'scale-type').value;
            const formula = isChordTab ? chordFormulas[type] : scaleFormulas[type];

            const rootIndex = notes.indexOf(root);
            const chordNotes = formula.intervals.map(interval => {
                const noteIndex = (rootIndex + interval) % 12;
                return notes[noteIndex];
            });

            return { notes: chordNotes, formula };
        }

        // Update theory display
        function updateTheoryDisplay() {
            const { notes: theoryNotes, formula } = calculateNotes();
            const isChordTab = currentTab === 'chords';
            const suffix = isChordTab ? 'chord' : 'scale';

            const notesStr = theoryNotes.map(n => noteDisplay[n] || n).join(' - ');
            document.getElementById(`info-notes-${suffix}`).textContent = notesStr;
            document.getElementById(`info-intervals-${suffix}`).textContent = formula.intervals.join(', ');
            document.getElementById(`info-formula-${suffix}`).textContent = formula.formula;

            // Show scale chords if in scales tab
            if (!isChordTab && formula.chords) {
                const chordsContainer = document.getElementById('scale-chords-container');
                chordsContainer.innerHTML = '';

                if (Array.isArray(formula.chords) && formula.chords.length > 1) {
                    const heading = document.createElement('h3');
                    heading.textContent = 'Diatonic Chords';
                    heading.style.width = '100%';
                    heading.style.textAlign = 'center';
                    heading.style.marginTop = '20px';
                    heading.style.color = '#f97316';
                    chordsContainer.appendChild(heading);

                    const buttonContainer = document.createElement('div');
                    buttonContainer.className = 'scale-chords-container';
                    chordsContainer.appendChild(buttonContainer);

                    formula.chords.forEach((chordQuality, index) => {
                        const scaleDegreeNote = theoryNotes[index];
                        const scaleDegreeNames = ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII'];
                        const scaleDegreeName = scaleDegreeNames[index];

                        let chordIntervals;
                        if (chordQuality === 'Maj') chordIntervals = [0, 4, 7];
                        else if (chordQuality === 'min') chordIntervals = [0, 3, 7];
                        else if (chordQuality === 'dim') chordIntervals = [0, 3, 6];
                        else if (chordQuality === 'aug') chordIntervals = [0, 4, 8];

                        const button = document.createElement('button');
                        button.className = 'chord-button';
                        button.innerHTML = `
                            <div class="chord-name">${scaleDegreeName} - ${noteDisplay[scaleDegreeNote] || scaleDegreeNote}</div>
                            <div class="chord-quality">${chordQuality}</div>
                        `;

                        button.addEventListener('click', function() {
                            playScaleChord(scaleDegreeNote, chordIntervals);
                        });

                        buttonContainer.appendChild(button);
                    });
                }
            }

            // Regenerate fretboard to show updated notes
            const fretboardId = isChordTab ? 'fretboard-chord' : 'fretboard-scale';
            generateFretboard(fretboardId, true);
        }

        // Highlight a note on the fretboard
        function highlightNoteOnFretboard(note, octave, duration = 1000, highlightAllOctaves = true) {
            const fretboardId = currentTab === 'chords' ? 'fretboard-chord' : 'fretboard-scale';
            const container = document.getElementById(fretboardId);

            if (!container) return;

            // Find note dots - either specific octave or all octaves
            const selector = highlightAllOctaves
                ? `.note-dot[data-note="${note}"]`
                : `.note-dot[data-note="${note}"][data-octave="${octave}"]`;
            const noteDots = container.querySelectorAll(selector);

            if (noteDots.length > 0) {
                // For scales, only light up the FIRST note found (to avoid multiple notes lighting up)
                // For chords, light up all occurrences
                const dotsToHighlight = (currentTab === 'scales' && noteDots.length > 1)
                    ? [noteDots[0]]
                    : Array.from(noteDots);

                // Light up note dots
                dotsToHighlight.forEach(dot => {
                    dot.classList.add('active');
                    setTimeout(() => {
                        dot.classList.remove('active');
                    }, duration);
                });
            } else {
                // Create ghost notes if this note isn't in the current chord/scale
                const tuning = tunings[document.getElementById('tuning-select')?.value || 'standard'];
                const numFrets = 12;
                const fretWidth = 60;

                // Find where this note would appear on the fretboard
                tuning.forEach((stringNote, stringIndex) => {
                    const stringNoteIndex = notes.indexOf(stringNote);
                    const stringOctave = stringOctaves[stringIndex];

                    for (let fret = 0; fret <= numFrets; fret++) {
                        const fretNoteIndex = (stringNoteIndex + fret) % 12;
                        const fretNote = notes[fretNoteIndex];
                        const fretOctave = stringOctave + Math.floor((stringNoteIndex + fret) / 12);

                        if (fretNote === note && fretOctave === octave) {
                            // Get the string line element
                            const stringLines = container.querySelectorAll('.string-line');
                            const actualStringIndex = tuning.length - 1 - stringIndex;
                            const stringLine = stringLines[actualStringIndex];

                            if (stringLine) {
                                // Create ghost note
                                const ghost = document.createElement('div');
                                const rootNote = document.getElementById(currentTab === 'chords' ? 'root-note-chord' : 'root-note-scale')?.value;
                                ghost.className = 'ghost-note';
                                if (note === rootNote) {
                                    ghost.className += ' root';
                                }

                                const xPos = 50 + fret * fretWidth + (fret === 0 ? 0 : fretWidth / 2);
                                ghost.style.left = `${xPos}px`;
                                ghost.style.top = '50%';
                                ghost.textContent = noteDisplay[note] || note;

                                stringLine.appendChild(ghost);

                                // Activate and then remove
                                setTimeout(() => {
                                    ghost.classList.add('active');
                                }, 10);

                                setTimeout(() => {
                                    ghost.remove();
                                }, duration);
                            }
                        }
                    }
                });
            }
        }

        // Play scale chord
        function playScaleChord(chordRoot, chordIntervals) {
            const rootIndex = notes.indexOf(chordRoot);
            const chordNotes = chordIntervals.map(interval => {
                const noteIndex = (rootIndex + interval) % 12;
                return notes[noteIndex];
            });

            const baseOctave = 3;
            const octaves = [];
            let lastNoteIndex = rootIndex;
            let currentOctaveOffset = 0;

            chordNotes.forEach((note, index) => {
                const noteIndex = notes.indexOf(note);
                if (index > 0 && noteIndex <= lastNoteIndex) {
                    currentOctaveOffset++;
                }
                octaves.push(baseOctave + currentOctaveOffset);
                lastNoteIndex = noteIndex;
            });

            chordNotes.forEach((note, index) => {
                playNote(note, octaves[index], 1);
                highlightNoteOnFretboard(note, octaves[index], 1000);
            });
        }

        // Play chord or scale
        function playChordOrScale() {
            const { notes: theoryNotes } = calculateNotes();
            const isChordTab = currentTab === 'chords';
            const root = document.getElementById(isChordTab ? 'root-note-chord' : 'root-note-scale').value;
            const rootIndex = notes.indexOf(root);

            let baseOctave = 3;
            if (currentTab === 'scales') {
                const targetStringIndex = currentScalePosition - 1;
                const rootInfo = findRootNoteOnString(targetStringIndex, root);
                baseOctave = rootInfo ? rootInfo.octave : 3;
            }
            const octaves = [];
            let lastNoteIndex = rootIndex;
            let currentOctaveOffset = 0;

            theoryNotes.forEach((note, index) => {
                const noteIndex = notes.indexOf(note);
                if (index > 0 && noteIndex <= lastNoteIndex) {
                    currentOctaveOffset++;
                }
                octaves.push(baseOctave + currentOctaveOffset);
                lastNoteIndex = noteIndex;
            });

            theoryNotes.forEach((note, index) => {
                playNote(note, octaves[index], 1);
                // For scales, only highlight specific octave; for chords, highlight all octaves
                const highlightAll = currentTab === 'chords';
                highlightNoteOnFretboard(note, octaves[index], 1000, highlightAll);
            });
        }

        // Play chord or scale as arpeggio
        function playChordOrScaleArpeggio() {
            const { notes: theoryNotes } = calculateNotes();
            const isChordTab = currentTab === 'chords';
            const root = document.getElementById(isChordTab ? 'root-note-chord' : 'root-note-scale').value;
            const rootIndex = notes.indexOf(root);

            let notesToPlay = [...theoryNotes];
            if (currentTab === 'scales') {
                notesToPlay.push(theoryNotes[0]);
            }

            let baseOctave = 3;
            if (currentTab === 'scales') {
                const targetStringIndex = currentScalePosition - 1;
                const rootInfo = findRootNoteOnString(targetStringIndex, root);
                baseOctave = rootInfo ? rootInfo.octave : 3;
            }
            const octaves = [];
            let lastNoteIndex = rootIndex;
            let currentOctaveOffset = 0;

            notesToPlay.forEach((note, index) => {
                const noteIndex = notes.indexOf(note);
                if (index > 0 && noteIndex <= lastNoteIndex) {
                    currentOctaveOffset++;
                }
                octaves.push(baseOctave + currentOctaveOffset);
                lastNoteIndex = noteIndex;
            });

            notesToPlay.forEach((note, index) => {
                setTimeout(() => {
                    playNote(note, octaves[index], 0.5);
                    // For scales, only highlight specific octave; for chords, highlight all octaves
                    const highlightAll = currentTab === 'chords';
                    highlightNoteOnFretboard(note, octaves[index], 500, highlightAll);
                }, index * 300);
            });
        }

        // Get string name by position
        function getStringNameByPosition(position) {
            const stringNames = ['Low E', 'A', 'D', 'G', 'B', 'High E'];
            return stringNames[position - 1] || 'Low E';
        }

        // Change scale position
        function changeScalePosition(delta) {
            currentScalePosition += delta;
            // Limit to 6 strings
            currentScalePosition = Math.max(1, Math.min(6, currentScalePosition));

            const stringName = getStringNameByPosition(currentScalePosition);
            document.getElementById('scale-position-display').textContent = `${stringName} String`;

            // Regenerate fretboard to show notes at new position
            if (currentTab === 'scales') {
                generateFretboard('fretboard-scale', true);
            }
        }

        // Get scale box pattern notes (8 notes: root through 7 scale degrees back to root)
        // Returns array of {string, fret, note, octave, isRoot} for the box pattern
        function getScaleBoxPattern(stringIndex, rootNote, scaleNotes) {
            const tuning = tunings[document.getElementById('tuning-select')?.value || 'standard'];

            // Find root note on the target string
            const rootInfo = findRootNoteOnString(stringIndex, rootNote);
            if (!rootInfo) return [];

            // Build ordered scale starting from root
            const rootIndex = scaleNotes.indexOf(rootNote);
            const orderedScale = [];
            for (let i = 0; i < 7; i++) {
                orderedScale.push(scaleNotes[(rootIndex + i) % scaleNotes.length]);
            }

            // Find all possible positions for scale notes on 3 strings
            const targetStrings = [stringIndex, Math.min(stringIndex + 1, 5), Math.min(stringIndex + 2, 5)];
            const allCandidates = [];

            targetStrings.forEach(str => {
                const stringNote = tuning[str];
                const stringNoteIndex = notes.indexOf(stringNote);
                const stringOctave = stringOctaves[str];

                // Search fret range starting from root position going higher
                const minFret = Math.max(0, rootInfo.fret);
                const maxFret = Math.min(12, rootInfo.fret + 12);

                for (let fret = minFret; fret <= maxFret; fret++) {
                    const fretNoteIndex = (stringNoteIndex + fret) % 12;
                    const fretNote = notes[fretNoteIndex];
                    const fretOctave = stringOctave + Math.floor((stringNoteIndex + fret) / 12);

                    // Only consider notes at or above the starting root octave
                    if (str < rootInfo.string || (str === rootInfo.string && fret < rootInfo.fret)) {
                        continue;
                    }

                    // Find which scale degree this note is
                    const noteScaleIndex = orderedScale.indexOf(fretNote);
                    if (noteScaleIndex !== -1) {
                        // Calculate actual position accounting for octave
                        let scalePosition = noteScaleIndex;

                        // If this is a root note and it's higher than the starting root, it's position 7 (ending root)
                        if (fretNote === rootNote && (str > rootInfo.string || (str === rootInfo.string && fret > rootInfo.fret))) {
                            // Check if this is actually higher in pitch
                            if (fretOctave > rootInfo.octave) {
                                scalePosition = 7; // Ending root
                            }
                        }

                        allCandidates.push({
                            string: str,
                            fret: fret,
                            note: fretNote,
                            octave: fretOctave,
                            isRoot: fretNote === rootNote,
                            scalePosition: scalePosition,
                            distance: Math.abs(fret - rootInfo.fret) + Math.abs(str - stringIndex)
                        });
                    }
                }
            });

            // Select exactly 8 notes - one for each scale degree plus ending root
            const boxNotes = [];
            const usedPositions = new Set();

            for (let pos = 0; pos < 8; pos++) {
                // Find candidates for this scale position
                const candidates = allCandidates.filter(c => {
                    const posKey = `${c.string}_${c.fret}`;
                    return c.scalePosition === pos && !usedPositions.has(posKey);
                });

                if (candidates.length > 0) {
                    // Choose the closest one to create a compact pattern
                    candidates.sort((a, b) => a.distance - b.distance);
                    const chosen = candidates[0];
                    boxNotes.push(chosen);
                    usedPositions.add(`${chosen.string}_${chosen.fret}`);
                }
            }

            return boxNotes;
        }

        // Find the first occurrence of root note on a specific string
        function findRootNoteOnString(stringIndex, rootNote) {
            const tuning = tunings[document.getElementById('tuning-select')?.value || 'standard'];
            const stringNote = tuning[stringIndex];
            const stringNoteIndex = notes.indexOf(stringNote);
            const rootNoteIndex = notes.indexOf(rootNote);
            const stringOctave = stringOctaves[stringIndex];

            // Find the fret where root note appears on this string
            for (let fret = 0; fret <= 12; fret++) {
                const fretNoteIndex = (stringNoteIndex + fret) % 12;
                if (fretNoteIndex === rootNoteIndex) {
                    const fretOctave = stringOctave + Math.floor((stringNoteIndex + fret) / 12);
                    return { fret, octave: fretOctave, string: stringIndex };
                }
            }
            return null;
        }

        // Switch tabs
        function switchTab(tab) {
            currentTab = tab;
            localStorage.setItem('guitarCurrentTab', tab);

            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.onclick && btn.onclick.toString().includes(tab)) {
                    btn.classList.add('active');
                }
            });

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tab}-tab`).classList.add('active');

            if (tab === 'play') {
                generateFretboard('fretboard-play', true);
            } else if (tab === 'chords') {
                generateFretboard('fretboard-chord', true);
                updateTheoryDisplay();
            } else if (tab === 'scales') {
                generateFretboard('fretboard-scale', true);
                updateTheoryDisplay();
            }
        }

        // Event listeners
        document.getElementById('root-note-chord').addEventListener('change', updateTheoryDisplay);
        document.getElementById('chord-type').addEventListener('change', updateTheoryDisplay);
        document.getElementById('root-note-scale').addEventListener('change', updateTheoryDisplay);
        document.getElementById('scale-type').addEventListener('change', updateTheoryDisplay);
        document.getElementById('tuning-select').addEventListener('change', () => generateFretboard('fretboard-play', true));

        // Initialize
        const savedTab = localStorage.getItem('guitarCurrentTab') || 'play';
        currentTab = savedTab;

        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`${savedTab}-tab`).classList.add('active');

        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
            if (btn.onclick && btn.onclick.toString().includes(savedTab)) {
                btn.classList.add('active');
            }
        });

        if (savedTab === 'play') {
            generateFretboard('fretboard-play', true);
        } else if (savedTab === 'chords') {
            generateFretboard('fretboard-chord', true);
            updateTheoryDisplay();
        } else if (savedTab === 'scales') {
            generateFretboard('fretboard-scale', true);
            updateTheoryDisplay();
        }

    </script>
</body>
</html>
